# vmstat 命令用法及输出说明

`vmstat` (Virtual Memory Statistics) 是一个用于监控系统虚拟内存、进程、CPU活动等性能数据的命令行工具。

## 基本用法

```bash
vmstat [选项] [间隔时间] [次数]
```

### 常用选项
- `-a`：显示活跃和非活跃内存
- `-d`：显示磁盘统计信息
- `-p`：显示指定磁盘分区的统计信息
- `-s`：显示内存相关统计信息及系统活动
- `-m`：显示slabinfo信息
- `-S`：指定显示单位(k/K/m/M，分别代表1000/1024/1000000/1048576字节)
- `-t`：在输出中增加时间戳

### 示例
```bash
vmstat         # 显示一次系统状态
vmstat 1       # 每1秒刷新一次
vmstat 1 5     # 每1秒刷新一次，共刷新5次
vmstat -a      # 显示活跃和非活跃内存
vmstat -d      # 显示磁盘统计信息
vmstat -s      # 显示内存统计摘要
```

## 输出说明

### 常规模式输出

```
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 1  0      0 123456  78900 456789    0    0    10    20  100  200 10  5 85  0  0
```

#### Procs (进程)
- `r`：运行队列中的进程数量
- `b`：等待I/O的进程数量（不可中断睡眠状态）

#### Memory (内存)
- `swpd`：使用的虚拟内存大小（KB）
- `free`：空闲的物理内存大小（KB）
- `buff`：用作缓冲区的内存大小（KB）
- `cache`：用作缓存的内存大小（KB）

#### Swap (交换分区)
- `si`：每秒从交换区读入内存的大小（KB/s）
- `so`：每秒从内存写入交换区的大小（KB/s）

#### IO (输入输出)
- `bi`：每秒从块设备接收的块数（blocks/s）
- `bo`：每秒发送到块设备的块数（blocks/s）

#### System (系统)
- `in`：每秒中断数，包括时钟中断
- `cs`：每秒上下文切换次数

#### CPU (处理器)
- `us`：用户进程占用CPU时间百分比
- `sy`：系统内核占用CPU时间百分比
- `id`：空闲CPU时间百分比
- `wa`：等待I/O的CPU时间百分比
- `st`：虚拟机偷取时间百分比（仅虚拟化环境）

### 磁盘模式输出 (`vmstat -d`)

```
disk- ------------reads------------ ------------writes----------- -----IO------
       total merged sectors      ms  total merged sectors      ms    cur    sec
sda   12345   678  987654  123456   5432   321  765432   98765      0    100
```

- `total`：完成的读/写总数
- `merged`：合并的读/写数
- `sectors`：读/写的扇区数
- `ms`：读/写花费的毫秒数
- `cur`：正在进行的I/O数
- `sec`：I/O花费的秒数

## 解读建议

1. **CPU瓶颈**：如果`us`持续高于70%，表示用户进程消耗大量CPU；`sy`持续高表示系统内核消耗大量CPU
2. **内存瓶颈**：`si`和`so`持续不为0，表示系统在使用交换空间，物理内存可能不足
3. **I/O瓶颈**：`wa`持续高表示I/O等待时间长，可能存在磁盘瓶颈
4. **进程阻塞**：`b`列数值高表示有进程在等待I/O

`vmstat`是快速诊断系统性能问题的有用工具，通常需要结合其他命令如`top`、`free`、`iostat`等一起分析。
