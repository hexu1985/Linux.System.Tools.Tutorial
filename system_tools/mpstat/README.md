# mpstat 命令用法及输出说明

`mpstat` 是 Linux 系统中用于监控 CPU 使用情况的工具，属于 `sysstat` 软件包的一部分。它可以显示每个 CPU 或所有 CPU 的详细使用统计信息。

## 基本用法

```bash
mpstat [选项] [间隔时间] [次数]
```

### 常用选项

- `-P {cpu|ALL}`：指定要报告的 CPU（0 表示第一个 CPU，ALL 表示所有 CPU）
- `-u`：显示 CPU 利用率（默认选项）
- `-I {SUM|CPU|ALL}`：报告中断统计信息
- `-V`：显示版本信息

## 示例命令

1. 显示所有 CPU 的即时统计信息：
   ```bash
   mpstat
   ```

2. 每 2 秒显示一次所有 CPU 的统计信息，共显示 5 次：
   ```bash
   mpstat 2 5
   ```

3. 显示特定 CPU（如 CPU 0）的统计信息：
   ```bash
   mpstat -P 0
   ```

4. 显示所有 CPU 的统计信息：
   ```bash
   mpstat -P ALL
   ```

## 输出字段说明

典型的 `mpstat` 输出如下：

```
Linux 5.4.0-91-generic (hostname) 	01/01/2022 	_x86_64_	(4 CPU)

10:30:00 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
10:30:01 AM  all    5.21    0.00    1.04    0.00    0.00    0.00    0.00    0.00    0.00   93.75
10:30:01 AM    0    6.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   93.00
10:30:01 AM    1    4.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00   95.00
```

各字段含义：

- **CPU**：CPU 编号（all 表示所有 CPU 的平均值）
- **%usr**：用户级别（应用程序）的 CPU 使用率
- **%nice**：nice 优先级用户程序的 CPU 使用率
- **%sys**：系统级别（内核）的 CPU 使用率
- **%iowait**：CPU 等待 I/O 操作的时间百分比
- **%irq**：处理硬件中断的时间百分比
- **%soft**：处理软件中断的时间百分比
- **%steal**：虚拟环境中被 hypervisor 偷走的时间百分比
- **%guest**：运行虚拟处理器的时间百分比
- **%gnice**：运行 nice 优先级 guest 的时间百分比
- **%idle**：CPU 空闲时间百分比

## 实际应用

1. **识别 CPU 瓶颈**：如果 %idle 持续很低，可能表示 CPU 资源不足
2. **I/O 等待分析**：高 %iowait 可能表示磁盘 I/O 瓶颈
3. **虚拟化环境监控**：%steal 高可能表示虚拟机资源被过度分配
4. **中断分析**：高 %soft 或 %irq 可能表示中断处理成为瓶颈

## 注意事项

1. 使用前需确保已安装 `sysstat` 包
2. 第一次运行 `mpstat` 时可能显示自启动以来的平均值，后续运行会显示间隔时间内的变化
3. 对于多核系统，建议使用 `-P ALL` 查看每个核心的详细情况

通过分析 `mpstat` 输出，可以全面了解系统 CPU 的使用情况和性能瓶颈。
