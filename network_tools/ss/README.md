# ss命令用法及输出说明

`ss`（Socket Statistics）是一个用于查看系统网络套接字信息的工具，比传统的 `netstat` 更高效，功能更丰富。以下是 `ss` 的常见用法及输出说明：

---

### **基本语法**
```bash
ss [选项] [过滤条件]
```

---

### **常用选项**
| 选项 | 说明 |
|------|------|
| `-t` | 显示 TCP 套接字 |
| `-u` | 显示 UDP 套接字 |
| `-l` | 仅显示监听状态的套接字 |
| `-a` | 显示所有套接字（包括监听和非监听） |
| `-n` | 禁用主机名解析（直接显示 IP 和端口号） |
| `-p` | 显示使用套接字的进程信息 |
| `-s` | 显示套接字统计信息（汇总） |
| `-4` | 仅显示 IPv4 套接字 |
| `-6` | 仅显示 IPv6 套接字 |
| `-o` | 显示计时器信息（如连接保持时间） |
| `-i` | 显示 TCP 内部信息（如拥塞窗口） |
| `-r` | 尝试解析数字端口为服务名称（如 22 → ssh） |

---

### **常用命令示例**
1. **查看所有 TCP 连接**
   ```bash
   ss -t -a
   ```

2. **查看所有监听中的 TCP 端口**
   ```bash
   ss -t -l
   ```

3. **查看 UDP 套接字并显示进程信息**
   ```bash
   ss -u -p
   ```

4. **查看所有 IPv4 监听端口（不解析主机名）**
   ```bash
   ss -4 -l -n
   ```

5. **显示套接字统计信息（类似 `netstat -s`）**
   ```bash
   ss -s
   ```

6. **过滤特定端口（如 80）**
   ```bash
   ss -t -a 'sport = :80'
   ```

7. **查看 ESTABLISHED 状态的连接**
   ```bash
   ss -t state established
   ```

---

### **输出字段说明**
执行 `ss -t -a -n -p` 的典型输出：
```
State      Recv-Q Send-Q Local Address:Port  Peer Address:Port
ESTAB      0      0      192.168.1.100:22    203.0.113.5:54321  users:(("sshd",pid=1234,fd=3))
LISTEN     0      128    *:80                 *:*               users:(("nginx",pid=5678,fd=6))
```

| 字段 | 说明 |
|------|------|
| `State` | 套接字状态（如 `ESTABLISHED`、`LISTEN`、`TIME-WAIT`） |
| `Recv-Q` | 接收队列中的数据量（字节） |
| `Send-Q` | 发送队列中的数据量（字节） |
| `Local Address:Port` | 本地 IP 和端口（`*` 表示任意地址） |
| `Peer Address:Port` | 远程 IP 和端口（仅对已连接套接字有效） |
| `users:(...)` | 使用套接字的进程信息（需 `-p` 选项） |

---

### **常见套接字状态**
| 状态 | 说明 |
|------|------|
| `LISTEN` | 正在监听连接请求 |
| `ESTABLISHED` | 已建立的连接 |
| `TIME-WAIT` | 等待足够时间以确保远程 TCP 收到连接终止请求 |
| `CLOSE-WAIT` | 等待本地应用关闭连接 |
| `SYN-SENT` | 客户端发送 SYN 请求后等待响应 |

---

### **过滤语法示例**
- 按端口过滤：
  ```bash
  ss -t 'sport = :80'       # 源端口 80
  ss -t 'dport = :443'      # 目标端口 443
  ```
- 按状态过滤：
  ```bash
  ss -t state established   # 所有已建立的 TCP 连接
  ss -t state time-wait     # 所有 TIME-WAIT 状态的连接
  ```

---

### **与 `netstat` 对比**
1. **性能**：`ss` 直接读取内核信息，比 `netstat` 更高效。
2. **功能**：`ss` 提供更详细的套接字信息（如计时器、拥塞窗口）。
3. **兼容性**：`netstat` 已逐渐被弃用，建议优先使用 `ss`。

---

通过灵活组合选项和过滤条件，可以快速诊断网络连接问题。
