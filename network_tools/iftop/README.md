# iftop命令用法及输出详解

`iftop` 是一个实时监控网络流量的命令行工具（类似 `top`，但针对网络流量），可以显示主机之间的带宽使用情况，帮助分析网络流量来源和去向。它通过监听指定网卡的流量，按流量大小排序显示连接会话。

---

## **基本用法**
```bash
sudo iftop [选项] [网卡名]
```

### **常用选项**
| 选项              | 说明                                                                 |
|-------------------|----------------------------------------------------------------------|
| `-i <网卡>`       | 指定监听的网卡（如 `eth0`、`wlan0`）。                               |
| `-n`              | 禁用主机名解析（直接显示 IP，加快速度）。                            |
| `-P`              | 显示端口号（Port）。                                                 |
| `-B`              | 以字节（Byte）为单位显示流量（默认是 bit）。                         |
| `-F <网段>`       | 只显示特定网段的流量（如 `192.168.1.0/24`）。                        |
| `-N`              | 不解析端口号（直接显示数字，而非服务名，如 `80` 代替 `http`）。       |
| `-p`              | 混杂模式（监听所有流量，即使不是本机的）。                           |

---

## **输出说明**
运行 `sudo iftop -i eth0 -P` 后的典型界面：
```
interface: eth0
IP: 192.168.1.100
Listening on eth0
# Host                   Port   => 另一主机                Port   2s  10s  40s 累计流量
192.168.1.100:443       => 203.0.113.45:52432         2.05Kb  1.41Kb  0.98Kb
203.0.113.45:52432      <= 192.168.1.100:443          1.23Kb  0.87Kb  0.45Kb
...
TX: 15.6KB/s  RX: 8.2KB/s  TOTAL: 23.8KB/s
```

### **界面解析**
1. **顶部信息**  
   - 当前监听的网卡（`eth0`）及其 IP 地址。  
   - **2s / 10s / 40s**：分别表示过去 2 秒、10 秒、40 秒的平均流量速率。  
   - **累计流量**：当前会话的总流量。

2. **连接会话列表**  
   - **`=>`** 表示 **出站流量**（本机发送到目标）。  
   - **`<=`** 表示 **入站流量**（目标发送到本机）。  
   - 默认按流量大小排序，高流量连接靠前显示。

3. **底部统计**  
   - **TX (Transmit)**：发送流量速率。  
   - **RX (Receive)**：接收流量速率。  
   - **TOTAL**：总带宽占用。

---

## **交互式操作**
在 `iftop` 运行时，可以按以下快捷键调整显示：
| 快捷键 | 功能                                                                 |
|--------|----------------------------------------------------------------------|
| `h`    | 显示帮助菜单。                                                       |
| `n`    | 切换是否解析主机名（相当于 `-n` 选项）。                             |
| `s`    | 显示源（Source）IP 的流量统计。                                      |
| `d`    | 显示目标（Destination）IP 的流量统计。                               |
| `t`    | 切换流量显示模式（单行/两行/合计）。                                 |
| `P`    | 显示/隐藏端口号（相当于 `-P` 选项）。                                |
| `j`/`k`| 上下滚动连接列表（如果连接太多）。                                   |
| `q`    | 退出 `iftop`。                                                       |

---

## **常见用途**
### **1. 查看实时带宽占用**
```bash
sudo iftop -i eth0
```
- 找出哪个 IP 或端口占用了最多带宽。

### **2. 监控特定网段的流量**
```bash
sudo iftop -F 192.168.1.0/24
```
- 只关注局域网（如 `192.168.1.0/24`）内的流量。

### **3. 检查端口级流量**
```bash
sudo iftop -P -i wlan0
```
- 显示端口号，方便排查具体服务（如 `443` = HTTPS，`22` = SSH）。

### **4. 排查异常流量**
```bash
sudo iftop -n -N -i eth0
```
- 禁用解析（加快速度），检查是否有未知 IP 大量通信（如 DDoS 或恶意软件）。

---

## **注意事项**
- **需要 root 权限**：`iftop` 需要访问原始网络数据，通常需 `sudo` 运行。  
- **仅显示活动连接**：不活动的连接不会显示。  
- **不保存历史数据**：退出后数据消失，如需记录可使用 `nethogs` 或 `vnstat`。  

---

## **类似工具**
| 工具       | 用途                                   |
|------------|----------------------------------------|
| `nethogs`  | 按进程统计带宽占用。                   |
| `vnstat`   | 长期记录带宽使用情况（按日/月统计）。  |
| `iptraf`   | 更详细的网络流量分析（TCP/UDP/ICMP）。 |

`iftop` 是快速诊断网络带宽问题的利器，适合排查突发流量、异常连接或带宽占用过高的情况！
